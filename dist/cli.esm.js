import{EventEmitter as t}from"events";function s(t){return null==t?[]:Array.isArray(t)?t:[t]}function n(t,s,n,e){var i,o=t[s],a=~e.string.indexOf(s)?null==n||!0===n?"":String(n):"boolean"==typeof n?n:~e.boolean.indexOf(s)?"false"!==n&&("true"===n||(t._.push(0*(i=+n)==0?i:n),!!n)):0*(i=+n)==0?i:n;t[s]=null==o?a:Array.isArray(o)?o.concat(a):[o,a]}const e=t=>t.replace(/[<[].+/,"").trim(),i=t=>t.sort(((t,s)=>t.length>s.length?-1:1))[0],o=(t,s)=>t.length>=s?t:`${t}${" ".repeat(s-t.length)}`,a=(t,s,n)=>{let e,i=0,o=s.length,a=t;for(;i<o;++i)e=a[s[i]],a=a[s[i]]=i===o-1?n:null!=e?e:!~s[i+1].indexOf(".")&&+s[i+1]>-1?[]:{}},r=(t,s)=>{for(const n of Object.keys(s)){const e=s[n];e.shouldTransform&&(t[n]=Array.prototype.concat.call([],t[n]),"function"==typeof e.transformFunction&&(t[n]=t[n].map(e.transformFunction)))}},l=t=>t.split(".").map(((t,s)=>0===s?t.replace(/([a-z])-([a-z])/g,((t,s,n)=>s+n.toUpperCase())):t)).join(".");class h extends Error{constructor(t){super(t),this.name=this.constructor.name,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error(t).stack}}class c{constructor(t,s,n){this.rawName=t,this.description=s,this.config=Object.assign({},n),t=t.replace(/\.\*/g,""),this.negated=!1,this.names=e(t).split(",").map((t=>{let s=t.trim().replace(/^-{1,2}/,"");return s.startsWith("no-")&&(this.negated=!0,s=s.replace(/^no-/,"")),l(s)})).sort(((t,s)=>t.length>s.length?1:-1)),this.name=this.names[this.names.length-1],this.negated&&null==this.config.default&&(this.config.default=!0),t.includes("<")?this.required=!0:t.includes("[")?this.required=!1:this.isBoolean=!0}}const m=process.argv,u=`${process.platform}-${process.arch} node-${process.version}`;class p{constructor(t,s,n={},i){this.rawName=t,this.description=s,this.config=n,this.cli=i,this.options=[],this.aliasNames=[],this.name=e(t),this.args=(t=>{const s=/<([^>]+)>/g,n=/\[([^\]]+)\]/g,e=[],i=t=>{let s=!1,n=t[1];return n.startsWith("...")&&(n=n.slice(3),s=!0),{required:t[0].startsWith("<"),value:n,variadic:s}};let o,a;for(;o=s.exec(t);)e.push(i(o));for(;a=n.exec(t);)e.push(i(a));return e})(t),this.examples=[]}usage(t){return this.usageText=t,this}allowUnknownOptions(){return this.config.allowUnknownOptions=!0,this}ignoreOptionDefaultValue(){return this.config.ignoreOptionDefaultValue=!0,this}version(t,s="-v, --version"){return this.versionNumber=t,this.option(s,"Display version number"),this}example(t){return this.examples.push(t),this}option(t,s,n){const e=new c(t,s,n);return this.options.push(e),this}alias(t){return this.aliasNames.push(t),this}action(t){return this.commandAction=t,this}isMatched(t){return this.name===t||this.aliasNames.includes(t)}get isDefaultCommand(){return""===this.name||this.aliasNames.includes("!")}get isGlobalCommand(){return this instanceof d}hasOption(t){return t=t.split(".")[0],this.options.find((s=>s.names.includes(t)))}outputHelp(){const{name:t,commands:s}=this.cli,{versionNumber:n,options:e,helpCallback:a}=this.cli.globalCommand;let r=[{body:`${t}${n?`/${n}`:""}`}];r.push({title:"Usage",body:`  $ ${t} ${this.usageText||this.rawName}`});if((this.isGlobalCommand||this.isDefaultCommand)&&s.length>0){const n=i(s.map((t=>t.rawName)));r.push({title:"Commands",body:s.map((t=>`  ${o(t.rawName,n.length)}  ${t.description}`)).join("\n")}),r.push({title:"For more info, run any command with the `--help` flag",body:s.map((s=>`  $ ${t}${""===s.name?"":` ${s.name}`} --help`)).join("\n")})}let l=this.isGlobalCommand?e:[...this.options,...e||[]];if(this.isGlobalCommand||this.isDefaultCommand||(l=l.filter((t=>"version"!==t.name))),l.length>0){const t=i(l.map((t=>t.rawName)));r.push({title:"Options",body:l.map((s=>`  ${o(s.rawName,t.length)}  ${s.description} ${void 0===s.config.default?"":`(default: ${s.config.default})`}`)).join("\n")})}this.examples.length>0&&r.push({title:"Examples",body:this.examples.map((s=>"function"==typeof s?s(t):s)).join("\n")}),a&&(r=a(r)||r),console.log(r.map((t=>t.title?`${t.title}:\n${t.body}`:t.body)).join("\n\n"))}outputVersion(){const{name:t}=this.cli,{versionNumber:s}=this.cli.globalCommand;s&&console.log(`${t}/${s} ${u}`)}checkRequiredArgs(){const t=this.args.filter((t=>t.required)).length;if(this.cli.args.length<t)throw new h(`missing required args for command \`${this.rawName}\``)}checkUnknownOptions(){const{options:t,globalCommand:s}=this.cli;if(!this.config.allowUnknownOptions)for(const n of Object.keys(t))if("--"!==n&&!this.hasOption(n)&&!s.hasOption(n))throw new h(`Unknown option \`${n.length>1?`--${n}`:`-${n}`}\``)}checkOptionValue(){const{options:t,globalCommand:s}=this.cli,n=[...s.options,...this.options];for(const s of n){const e=t[s.name.split(".")[0]];if(s.required){const t=n.some((t=>t.negated&&t.names.includes(s.name)));if(!0===e||!1===e&&!t)throw new h(`option \`${s.rawName}\` value is missing`)}}}}class d extends p{constructor(t){super("@@global@@","",{},t)}}var f=Object.assign;class g extends t{constructor(t=""){super(),this.name=t,this.commands=[],this.rawArgs=[],this.args=[],this.options={},this.globalCommand=new d(this),this.globalCommand.usage("<command> [options]")}usage(t){return this.globalCommand.usage(t),this}command(t,s,n){const e=new p(t,s||"",n,this);return e.globalCommand=this.globalCommand,this.commands.push(e),e}option(t,s,n){return this.globalCommand.option(t,s,n),this}help(t){return this.globalCommand.option("-h, --help","Display this message"),this.globalCommand.helpCallback=t,this.showHelpOnExit=!0,this}version(t,s="-v, --version"){return this.globalCommand.version(t,s),this.showVersionOnExit=!0,this}example(t){return this.globalCommand.example(t),this}outputHelp(){this.matchedCommand?this.matchedCommand.outputHelp():this.globalCommand.outputHelp()}outputVersion(){this.globalCommand.outputVersion()}setParsedInfo({args:t,options:s},n,e){return this.args=t,this.options=s,n&&(this.matchedCommand=n),e&&(this.matchedCommandName=e),this}unsetMatchedCommand(){this.matchedCommand=void 0,this.matchedCommandName=void 0}parse(t=m,{run:s=!0}={}){this.rawArgs=t,this.name||(this.name=t[1]?(t=>{const s=/([^\\\/]+)$/.exec(t);return s?s[1]:""})(t[1]):"cli");let n=!0;for(const s of this.commands){const e=this.mri(t.slice(2),s),i=e.args[0];if(s.isMatched(i)){n=!1;const t=f(f({},e),{args:e.args.slice(1)});this.setParsedInfo(t,s,i),this.emit(`command:${i}`,s)}}if(n)for(const s of this.commands)if(""===s.name){n=!1;const e=this.mri(t.slice(2),s);this.setParsedInfo(e,s),this.emit("command:!",s)}if(n){const s=this.mri(t.slice(2));this.setParsedInfo(s)}this.options.help&&this.showHelpOnExit&&(this.outputHelp(),s=!1,this.unsetMatchedCommand()),this.options.version&&this.showVersionOnExit&&null==this.matchedCommandName&&(this.outputVersion(),s=!1,this.unsetMatchedCommand());const e={args:this.args,options:this.options};return s&&this.runMatchedCommand(),!this.matchedCommand&&this.args[0]&&this.emit("command:*"),e}mri(t,e){const i=[...this.globalCommand.options,...e?e.options:[]],o=(t=>{const s={alias:{},boolean:[]};for(const[n,e]of t.entries())if(e.names.length>1&&(s.alias[e.names[0]]=e.names.slice(1)),e.isBoolean)if(e.negated){const i=t.some(((t,s)=>s!==n&&t.names.some((t=>e.names.includes(t)))&&"boolean"==typeof t.required));i||s.boolean.push(e.names[0])}else s.boolean.push(e.names[0]);return s})(i);let h=[];const c=t.indexOf("--");c>-1&&(h=t.slice(c+1),t=t.slice(0,c));let m=function(t,e){e=e||{};var i,o,a,r,l,h={_:[]},c=0,m=0,u=0,p=(t=t||[]).length;const d=void 0!==e.alias,f=void 0!==e.unknown,g=void 0!==e.default;if(e.alias=e.alias||{},e.string=s(e.string),e.boolean=s(e.boolean),d)for(i in e.alias)for(o=e.alias[i]=s(e.alias[i]),c=0;c<o.length;c++)(e.alias[o[c]]=o.concat(i)).splice(c,1);for(c=e.boolean.length;c-- >0;)for(m=(o=e.alias[e.boolean[c]]||[]).length;m-- >0;)e.boolean.push(o[m]);for(c=e.string.length;c-- >0;)for(m=(o=e.alias[e.string[c]]||[]).length;m-- >0;)e.string.push(o[m]);if(g)for(i in e.default)if(r=typeof e.default[i],o=e.alias[i]=e.alias[i]||[],void 0!==e[r])for(e[r].push(i),c=0;c<o.length;c++)e[r].push(o[c]);const b=f?Object.keys(e.alias):[];for(c=0;c<p;c++){if("--"===(a=t[c])){h._=h._.concat(t.slice(++c));break}for(m=0;m<a.length&&45===a.charCodeAt(m);m++);if(0===m)h._.push(a);else if("no-"===a.substring(m,m+3)){if(r=a.substring(m+3),f&&!~b.indexOf(r))return e.unknown(a);h[r]=!1}else{for(u=m+1;u<a.length&&61!==a.charCodeAt(u);u++);for(r=a.substring(m,u),l=a.substring(++u)||c+1===p||45===(""+t[c+1]).charCodeAt(0)||t[++c],o=2===m?[r]:r,u=0;u<o.length;u++){if(r=o[u],f&&!~b.indexOf(r))return e.unknown("-".repeat(m)+r);n(h,r,u+1<o.length||l,e)}}}if(g)for(i in e.default)void 0===h[i]&&(h[i]=e.default[i]);if(d)for(i in h)for(o=e.alias[i]||[];o.length>0;)h[o.shift()]=h[i];return h}(t,o);m=Object.keys(m).reduce(((t,s)=>f(f({},t),{[l(s)]:m[s]})),{_:[]});const u=m._,p={"--":h},d=e&&e.config.ignoreOptionDefaultValue?e.config.ignoreOptionDefaultValue:this.globalCommand.config.ignoreOptionDefaultValue;let g=Object.create(null);for(const t of i){if(!d&&void 0!==t.config.default)for(const s of t.names)p[s]=t.config.default;Array.isArray(t.config.type)&&void 0===g[t.name]&&(g[t.name]=Object.create(null),g[t.name].shouldTransform=!0,g[t.name].transformFunction=t.config.type[0])}for(const t of Object.keys(m))if("_"!==t){const s=t.split(".");a(p,s,m[t]),r(p,g)}return{args:u,options:p}}runMatchedCommand(){const{args:t,options:s,matchedCommand:n}=this;if(!n||!n.commandAction)return;n.checkUnknownOptions(),n.checkOptionValue(),n.checkRequiredArgs();const e=[];return n.args.forEach(((s,n)=>{s.variadic?e.push(t.slice(n)):e.push(t[n])})),e.push(s),n.commandAction.apply(this,e)}}const b=((t="")=>new g(t))("vue-i18n-translate-csv");b.command("generate [root]","generate csv file").alias("gen").alias("g").option("-i, --input <file>","file containing all messages",{default:"./src/i18n/ko/index.js"}).action(((t="",s)=>{console.log(t,s)})),b.command("input [root]","read csv file and overwrite message file").alias("i").option("-i, --input <file>","csv file").option("-k, --korean <file>","included Korean message file").option("-e, --english <file>","included English message file").action(((t="",s)=>{console.log(t,s)})),b.help(),b.parse();
